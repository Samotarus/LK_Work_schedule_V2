```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ—Ç —Å–º–µ–Ω</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <style>
        /* –ò–∫–æ–Ω–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è */
        .icon-calendar::before {
            content: "üìÖ";
            margin-right: 5px;
        }
        .icon-clock::before {
            content: "üïí";
            margin-right: 5px;
        }
        .icon-ruble::before {
            content: "‚ÇΩ";
            margin-right: 2px;
            font-weight: bold;
        }
        /* Custom styles that can't be easily done with Tailwind */
        .shift-job {
            white-space: normal;
            word-wrap: break-word;
            max-width: 100%;
            text-align: center;
        }
        .multi-day-shift {
            position: relative;
            z-index: 1;
        }
        .multi-day-shift::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                rgba(0, 0, 0, 0.1),
                rgba(0, 0, 0, 0.1) 5px,
                rgba(0, 0, 0, 0.05) 5px,
                rgba(0, 0, 0, 0.05) 10px
            );
            pointer-events: none;
            border-radius: 0.375rem;
            z-index: -1;
        }
        .cross-month-shift {
            position: relative;
        }
        .cross-month-shift::before {
            content: '‚Üí';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            color: #666;
        }
        /* Animation for calendar days */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .calendar-day {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @media (max-width: 640px) {
            .calendar-day {
                min-height: 60px !important;
                padding: 4px !important;
            }
            .shift-info {
                font-size: 0.7rem !important;
            }
            .shift-job, .shift-coeff {
                font-size: 0.6rem !important;
                padding: 0.1rem !important;
            }
        }
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        /* Custom animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.3s ease-out;
        }
        .animate-fade-out {
            animation: fadeInUp 0.3s ease-out reverse;
        }
        .chevron-rotate {
            transition: transform 0.2s ease;
        }
        .chevron-rotate.rotate-180 {
            transform: rotate(180deg);
        }
        /* Selected days styling */
        .selected-day {
            border-color: #4CAF50 !important;
            border-width: 3px !important;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3) !important;
        }
        /* Keep selection when dragging */
        .drag-selection {
            position: relative;
        }
        .drag-selection::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 0.375rem;
            z-index: -1;
        }
        /* Real-time drag selection */
        .drag-start {
            border-color: #4CAF50 !important;
            border-width: 3px !important;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3) !important;
        }
        .drag-end {
            border-color: #4CAF50 !important;
            border-width: 3px !important;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3) !important;
        }
        .drag-middle {
            background-color: rgba(76, 175, 80, 0.1) !important;
            border-color: #4CAF50 !important;
            border-width: 1px !important;
            border-style: solid !important;
            border-radius: 0.25rem !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-green-600 to-green-500 p-6 text-white">
                <h1 class="text-3xl font-bold">–£—á–µ—Ç —Å–º–µ–Ω –∏ –∑–∞—Ä–∞–±–æ—Ç–∫–∞</h1>
                <p class="opacity-90 mt-1">–£–¥–æ–±–Ω—ã–π —É—á–µ—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–∞—Å—á–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞</p>
            </div>
            <!-- Main Content -->
            <div class="p-6">
                <!-- Form Section -->
                <div class="bg-gray-50 rounded-lg p-6 mb-8 border border-gray-200">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-plus-circle mr-2 text-green-600"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–º–µ–Ω—É
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="startDate">
                                <i class="fas fa-calendar-day mr-2 text-blue-500"></i> –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:
                            </label>
                            <input type="date" id="startDate" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="startTime">
                                <i class="fas fa-clock mr-2 text-blue-500"></i> –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:
                            </label>
                            <input type="time" id="startTime" value="09:00" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="endDate">
                                <i class="fas fa-calendar-day mr-2 text-blue-500"></i> –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:
                            </label>
                            <input type="date" id="endDate" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="endTime">
                                <i class="fas fa-clock mr-2 text-blue-500"></i> –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:
                            </label>
                            <input type="time" id="endTime" value="18:00" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="jobName">
                                <i class="fas fa-briefcase mr-2 text-blue-500"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã:
                            </label>
                            <input type="text" id="jobName" list="jobSuggestions" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–µ–∫—Ç –ê" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                            <datalist id="jobSuggestions"></datalist>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="baseRate">
                                <i class="fas fa-money-bill-wave mr-2 text-blue-500"></i> –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (—Ä—É–±):
                            </label>
                            <input type="number" id="baseRate" value="6700" min="1" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                        </div>
                    </div>
                    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="calculateEarnings()" id="submitButton"
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center">
                            <i class="fas fa-plus-circle mr-2"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å
                        </button>
                        <button onclick="clearForm()"
                            class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-4 rounded-lg transition flex items-center justify-center">
                            <i class="fas fa-broom mr-2"></i> –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                        </button>
                    </div>
                </div>
                <!-- Calendar Section -->
                <div class="mb-8">
                    <div class="flex flex-col sm:flex-row justify-center items-center mb-6 gap-4">
                        <h2 class="text-xl font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-calendar-alt mr-2 text-green-600"></i>
                            <span id="monthDisplay">–ò—é–ª—å 2025</span>
                        </h2>
                        <div class="flex items-center gap-2 flex-wrap">
                            <div class="flex items-center gap-2">
                                <button onclick="changeMonth(-1)" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü"
                                    class="w-10 h-10 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center transition">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <select id="monthSelect" onchange="goToSelectedMonth()"
                                    class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"></select>
                                <select id="yearSelect" onchange="goToSelectedMonth()"
                                    class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"></select>
                                <button onclick="changeMonth(1)" title="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü"
                                    class="w-10 h-10 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center transition">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <button onclick="goToToday()"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition flex items-center w-full sm:w-auto justify-center">
                                <i class="fas fa-calendar-day mr-2"></i> –°–µ–≥–æ–¥–Ω—è
                            </button>
                        </div>
                    </div>
                    <div class="border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <div class="grid grid-cols-7 bg-green-600 text-white text-center font-medium py-3">
                            <div>–ü–Ω</div>
                            <div>–í—Ç</div>
                            <div>–°—Ä</div>
                            <div>–ß—Ç</div>
                            <div>–ü—Ç</div>
                            <div>–°–±</div>
                            <div>–í—Å</div>
                        </div>
                        <div class="grid grid-cols-7" id="calendarDays"></div>
                    </div>
                </div>
                <!-- Log Section -->
                <div class="bg-gray-50 rounded-lg p-6 border border-gray-200" id="log">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-clock mr-2 text-green-600"></i> –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–±–æ—Ç
                        </h2>
                        <div class="flex gap-2">
                            <button onclick="exportShifts()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition flex items-center text-sm">
                                <i class="fas fa-file-export mr-2"></i> –≠–∫—Å–ø–æ—Ä—Ç
                            </button>
                            <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition flex items-center text-sm">
                                <i class="fas fa-file-import mr-2"></i> –ò–º–ø–æ—Ä—Ç
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none" onchange="importShifts(this)">
                        </div>
                    </div>
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                    </div>
                </div>
                <!-- Statistics Section -->
                <div class="mt-8 bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-chart-line text-green-600 mr-2"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
                    </h3>
                    <div class="border-t border-gray-200 pt-4">
                        <!-- Tabs -->
                        <div class="flex border-b border-gray-200 mb-4">
                            <button id="yearTab" onclick="switchTab('year')" 
                                class="px-4 py-2 font-medium text-gray-700 hover:text-green-600 hover:bg-gray-100 rounded-t-lg transition">
                                –ì–æ–¥
                            </button>
                            <button id="periodTab" onclick="switchTab('period')" 
                                class="px-4 py-2 font-medium text-gray-700 hover:text-green-600 hover:bg-gray-100 rounded-t-lg transition">
                                –î–Ω–∏
                            </button>
                        </div>
                        
                        <!-- Year Statistics -->
                        <div id="yearStats" class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h4 class="font-medium text-gray-700">–ì–æ–¥:</h4>
                                <span id="yearlyStatsTitle" class="font-semibold text-green-600"></span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <div class="text-blue-800 font-medium mb-1">–û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫</div>
                                    <div class="text-2xl font-bold text-blue-600" id="yearlyEarnings">0 ‚ÇΩ</div>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <div class="text-green-800 font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ–Ω</div>
                                    <div class="text-2xl font-bold text-green-600" id="yearlyShiftsCount">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Period Statistics -->
                        <div id="periodStats" class="space-y-4 hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1" for="periodStart">
                                        <i class="fas fa-calendar-day mr-2 text-blue-500"></i> –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞:
                                    </label>
                                    <input type="date" id="periodStart" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1" for="periodEnd">
                                        <i class="fas fa-calendar-day mr-2 text-blue-500"></i> –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞:
                                    </label>
                                    <input type="date" id="periodEnd" required
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition">
                                </div>
                            </div>
                            <button onclick="calculatePeriodStats()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition mb-4">
                                <i class="fas fa-calculator mr-2"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥
                            </button>
                            <div id="periodStatsResults" class="hidden space-y-4">
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <div class="text-blue-800 font-medium mb-1">–û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫</div>
                                    <div class="text-2xl font-bold text-blue-600" id="periodEarnings">0 ‚ÇΩ</div>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <div class="text-green-800 font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ–Ω</div>
                                    <div class="text-2xl font-bold text-green-600" id="periodShiftsCount">0</div>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                                    <div class="text-purple-800 font-medium mb-1">–ü–µ—Ä–∏–æ–¥</div>
                                    <div class="text-lg font-bold text-purple-600" id="periodRange"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Bottom Action Buttons -->
                <div class="mt-8 flex flex-wrap gap-4 justify-center">
                    <button onclick="exportShifts()" 
                        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium flex items-center">
                        <i class="fas fa-file-export mr-2"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <button onclick="document.getElementById('importFile').click()" 
                        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition font-medium flex items-center">
                        <i class="fas fa-file-import mr-2"></i> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none" onchange="importShifts(this)">
                </div>
            </div>
        </div>
    </div>
    <script>
        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç–∞–≤–∫–æ–π ---
        function getBaseRate() {
            return parseFloat(localStorage.getItem('baseRate') || '6700');
        }
        function setBaseRate(rate) {
            localStorage.setItem('baseRate', rate.toString());
        }
        function initializeBaseRate() {
            const baseRateInput = document.getElementById('baseRate');
            baseRateInput.value = getBaseRate();
        }
        // --- –ö–æ–Ω–µ—Ü —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞–≤–∫–æ–π ---
        // –¶–≤–µ—Ç–∞ –¥–ª—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
        const coefficientColors = {
            1: "#00C853",     // 1 - –∑–µ–ª–µ–Ω—ã–π
            1.4: "#FFAB00",   // 1.4 - –æ—Ä–∞–Ω–∂–µ–≤—ã–π
            1.9: "#FFD600",   // 1.9 - –∂–µ–ª—Ç—ã–π
            2.5: "#FF6D00",   // 2.5 - –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π
            3.2: "#0091EA",   // 3.2 - –≥–æ–ª—É–±–æ–π
            4: "#DD2C00",     // 4 - —Ç–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π
            4.9: "#757575",   // 4.9 - —Å–µ—Ä—ã–π
            5.9: "#FFEA00",   // 5.9 - —Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π
            7: "#2962FF"      // 7 - —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π
        };
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã)
        function getColorFromString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return "#" + "00000".substring(0, 6 - c.length) + c;
        }
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∏–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã (—Ü–≤–µ—Ç–∞)
        function getWorkStyle(jobName) {
            const color = getColorFromString(jobName);
            const hsv = rgbToHsv(parseInt(color.slice(1, 3), 16), parseInt(color.slice(3, 5), 16), parseInt(color.slice(5, 7), 16));
            hsv.s = 0.7;
            hsv.v = 0.8;
            const rgb = hsvToRgb(hsv.h, hsv.s, hsv.v);
            const bgColor = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            const borderColor = `rgb(${Math.max(0, rgb.r - 30)}, ${Math.max(0, rgb.g - 30)}, ${Math.max(0, rgb.b - 30)})`;
            return { bgColor, borderColor };
        }
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–≤–µ—Ç–æ–≤
        function rgbToHsv(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, v = max;
            const d = max - min;
            s = max === 0 ? 0 : d / max;
            if (max === min) {
                h = 0;
            } else {
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return { h, s, v };
        }
        function hsvToRgb(h, s, v) {
            let r, g, b;
            const i = Math.floor(h * 6);
            const f = h * 6 - i;
            const p = v * (1 - s);
            const q = v * (1 - f * s);
            const t = v * (1 - (1 - f) * s);
            switch (i % 6) {
                case 0: r = v; g = t; b = p; break;
                case 1: r = q; g = v; b = p; break;
                case 2: r = p; g = v; b = t; break;
                case 3: r = p; g = q; b = v; break;
                case 4: r = t; g = p; b = v; break;
                case 5: r = v; g = p; b = q; break;
            }
            return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
        }
        let currentViewDate = new Date();
        let editingId = null;
        let isDragging = false;
        let startDragDate = null;
        let endDragDate = null;
        let selectedPeriod = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.onmouseup = function() {
            isDragging = false;
        };
        
        // Touch events for mobile devices
        document.ontouchend = function() {
            isDragging = false;
        };
        
        window.onload = function() {
            populateMonthYearSelectors();
            updateCalendar();
            loadLog();
            updateJobSuggestions();
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const today = new Date();
            const todayStr = formatDateToYYYYMMDD(today);
            startDateInput.value = todayStr;
            endDateInput.value = todayStr;
            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è
            startDateInput.addEventListener('input', function() {
                const startYear = this.value.split('-')[0];
                if (!endDateInput.value || endDateInput.value.includes('0002')) {
                    let endMonthDay = '01-01';
                    if (endDateInput.value && endDateInput.value.length >= 5) {
                        endMonthDay = endDateInput.value.slice(5);
                    } else {
                        endMonthDay = this.value.slice(5);
                    }
                    const newEndDate = `${startYear}-${endMonthDay}`;
                    const tempDate = new Date(newEndDate);
                    if (!isNaN(tempDate.getTime()) && tempDate.getFullYear() == startYear) {
                        endDateInput.value = newEndDate;
                    }
                }
            });
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏
            initializeBaseRate();
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
            document.getElementById('baseRate').addEventListener('change', function() {
                const newRate = parseFloat(this.value);
                if (!isNaN(newRate) && newRate > 0) {
                    setBaseRate(newRate);
                    updateCalendar();
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏.');
                    this.value = getBaseRate();
                }
            });
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç –¥–ª—è –ø–µ—Ä–∏–æ–¥–∞
            const periodStart = document.getElementById('periodStart');
            const periodEnd = document.getElementById('periodEnd');
            periodStart.value = todayStr;
            periodEnd.value = todayStr;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateYearlyStats();
        };
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –º–µ—Å—è—Ü–µ–≤ –∏ –ª–µ—Ç
        function populateMonthYearSelectors() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            monthSelect.innerHTML = '';
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = month;
                monthSelect.appendChild(option);
            });
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            for (let i = currentYear - 5; i <= currentYear + 5; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }
        }
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ —Å—Ç—Ä–æ–∫—É YYYY-MM-DD
        function formatDateToYYYYMMDD(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –≥–æ–¥ –∏ –º–µ—Å—è—Ü –∏–∑ —Å—Ç—Ä–æ–∫–∏ –¥–∞—Ç—ã YYYY-MM-DD
        function getYearMonth(dateStr) {
            if (!dateStr) return null;
            const parts = dateStr.split('-');
            return `${parts[0]}-${parts[1]}`; // "2025-07"
        }
        // –û–±—Ä–µ–∑–∫–∞ —Å—Ç—Ä–æ–∫–∏ —Å –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ–º
        function truncateString(str, maxLength) {
            if (str.length <= maxLength) return str;
            return str.slice(0, maxLength) + '...';
        }
        // Update visual selection during drag
        function updateSelectedDates() {
            const days = document.querySelectorAll('.calendar-day');
            days.forEach(day => {
                const dayDate = day.getAttribute('data-date');
                if (!dayDate) return;
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏ –≤—ã–±–æ—Ä–∞
                day.classList.remove('drag-start', 'drag-end', 'drag-middle');
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥, –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏
                if (startDragDate && endDragDate) {
                    const startDate = new Date(startDragDate);
                    const endDate = new Date(endDragDate);
                    const currentDate = new Date(dayDate);
                    
                    // Swap dates if start is after end
                    const realStart = startDate < endDate ? startDate : endDate;
                    const realEnd = startDate < endDate ? endDate : startDate;
                    
                    if (currentDate >= realStart && currentDate <= realEnd) {
                        if (currentDate.getTime() === realStart.getTime()) {
                            day.classList.add('drag-start');
                        } else if (currentDate.getTime() === realEnd.getTime()) {
                            day.classList.add('drag-end');
                        } else {
                            day.classList.add('drag-middle');
                        }
                    }
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –≥–æ–¥
        function updateYearlyStats() {
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            const currentYear = currentViewDate.getFullYear();
            const yearlyShifts = log.filter(entry => {
                const entryYear = new Date(entry.startDate).getFullYear();
                return entryYear === currentYear;
            });
            const totalEarnings = yearlyShifts.reduce((sum, shift) => sum + parseFloat(shift.earnings), 0);
            const shiftsCount = yearlyShifts.length;
            document.getElementById('yearlyEarnings').textContent = `${totalEarnings.toFixed(2)} ‚ÇΩ`;
            document.getElementById('yearlyShiftsCount').textContent = shiftsCount;
            document.getElementById('yearlyStatsTitle').textContent = currentYear;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –ª–æ–≥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        function updateCalendar() {
            updateYearlyStats();
            const calendarEl = document.getElementById('calendarDays');
            calendarEl.innerHTML = '';
            const year = currentViewDate.getFullYear();
            const month = currentViewDate.getMonth();
            const monthName = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'][month];
            document.getElementById('monthDisplay').textContent = `${monthName} ${year}`;
            document.getElementById('monthSelect').value = month;
            document.getElementById('yearSelect').value = year;
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            const firstDayOfWeek = firstDayOfMonth.getDay() || 7;
            const offset = firstDayOfWeek - 1;
            const shiftLog = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            const currentMonthStr = getYearMonth(formatDateToYYYYMMDD(currentViewDate));
            const shiftsThisMonth = shiftLog.filter(entry => 
                getYearMonth(entry.endDate) === currentMonthStr || 
                getYearMonth(entry.startDate) === currentMonthStr
            );
            const shiftsByDate = {};
            shiftsThisMonth.forEach(entry => {
                if (!shiftsByDate[entry.startDate]) {
                    shiftsByDate[entry.startDate] = [];
                }
                shiftsByDate[entry.startDate].push(entry);
                if (entry.startDate !== entry.endDate) {
                    if (!shiftsByDate[entry.endDate]) {
                        shiftsByDate[entry.endDate] = [];
                    }
                    shiftsByDate[entry.endDate].push(entry);
                }
            });
            // –î–Ω–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const prevMonthLastDay = new Date(year, month - 1, 0).getDate();
            for (let i = offset; i > 0; i--) {
                const dayNum = prevMonthLastDay - i + 1;
                const date = new Date(year, month - 1, dayNum);
                const dateStr = formatDateToYYYYMMDD(date);
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day p-2 border border-gray-100 text-gray-400 bg-gray-50 min-h-20';
                dayEl.innerHTML = `<div class="text-sm font-medium">${dayNum}</div>`;
                calendarEl.appendChild(dayEl);
            }
            // –î–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDateToYYYYMMDD(date);
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day p-2 border border-gray-100 min-h-20 relative';
                const dayNumberEl = document.createElement('div');
                dayNumberEl.className = 'text-xs sm:text-sm font-medium mb-1';
                dayNumberEl.textContent = day;
                dayEl.appendChild(dayNumberEl);
                if (shiftsByDate[dateStr]) {
                    shiftsByDate[dateStr].forEach(shift => {
                        const style = getWorkStyle(shift.jobName);
                        const infoEl = document.createElement('div');
                        infoEl.className = 'shift-info mb-1';
                        const jobEl = document.createElement('div');
                        jobEl.className = 'shift-job text-xs px-1 py-0.5 rounded';
                        jobEl.textContent = truncateString(shift.jobName, 15);
                        jobEl.title = shift.jobName;
                        jobEl.style.backgroundColor = style.bgColor;
                        jobEl.style.borderColor = style.borderColor;
                        jobEl.style.borderWidth = '1px';
                        jobEl.style.borderStyle = 'solid';
                        jobEl.style.borderRadius = '3px';
                        jobEl.style.color = 'white';
                        const coeffEl = document.createElement('div');
                        coeffEl.className = 'shift-coeff text-xs px-1 py-0.5 rounded mt-0.5';
                        coeffEl.textContent = `K${shift.durationCoefficient}`;
                        const coeffColor = coefficientColors[shift.durationCoefficient] || '#808080';
                        coeffEl.style.backgroundColor = coeffColor;
                        coeffEl.style.borderColor = coeffColor;
                        coeffEl.style.color = 'white';
                        infoEl.appendChild(jobEl);
                        infoEl.appendChild(coeffEl);
                        dayEl.appendChild(infoEl);
                        dayEl.style.borderColor = style.borderColor;
                        dayEl.style.borderWidth = '2px';
                        dayEl.style.borderStyle = 'solid';
                        dayEl.style.borderRadius = '0.375rem';
                        if (shift.startDate !== shift.endDate) {
                            dayEl.classList.add('multi-day-shift');
                            const shiftStartDate = new Date(shift.startDate);
                            const shiftEndDate = new Date(shift.endDate);
                            const currentDate = new Date(dateStr);
                            // –ï—Å–ª–∏ —Å–º–µ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
                            if (shiftStartDate.getMonth() !== shiftEndDate.getMonth()) {
                                // –î–ª—è –¥–Ω–µ–π –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (–Ω–∞—á–∞–ª–æ —Å–º–µ–Ω—ã)
                                if (currentDate.getMonth() === shiftStartDate.getMonth()) {
                                    dayEl.classList.add('cross-month-shift');
                                }
                                // –î–ª—è –¥–Ω–µ–π –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (–æ–∫–æ–Ω—á–∞–Ω–∏–µ —Å–º–µ–Ω—ã)
                                else if (currentDate.getMonth() === shiftEndDate.getMonth()) {
                                    dayEl.classList.add('cross-month-shift');
                                }
                            }
                        }
                    });
                }
                dayEl.setAttribute('data-date', dateStr);
                
                // Mouse events
                dayEl.onmousedown = function(e) {
                    isDragging = true;
                    startDragDate = dateStr;
                    endDragDate = dateStr;
                    updateSelectedDates();
                    e.preventDefault(); // Prevent text selection during drag
                };
                
                dayEl.onmouseenter = function() {
                    if (isDragging) {
                        endDragDate = dateStr;
                        updateSelectedDates();
                    }
                };
                
                dayEl.onmouseup = function() {
                    if (isDragging) {
                        isDragging = false;
                        const startDateInput = document.getElementById('startDate');
                        const endDateInput = document.getElementById('endDate');
                        startDateInput.value = startDragDate;
                        endDateInput.value = endDragDate;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                        selectedPeriod = {
                            start: startDragDate,
                            end: endDragDate
                        };
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥
                        updatePeriodStats();
                        
                        updateCalendar();
                    }
                };
                
                // Touch events for mobile
                dayEl.addEventListener('touchstart', function(e) {
                    isDragging = true;
                    startDragDate = dateStr;
                    endDragDate = dateStr;
                    updateSelectedDates();
                    e.preventDefault();
                }, { passive: false });
                
                dayEl.addEventListener('touchmove', function(e) {
                    if (isDragging) {
                        const touch = e.touches[0];
                        const element = document.elementFromPoint(touch.clientX, touch.clientY);
                        if (element && element.classList.contains('calendar-day')) {
                            const dayDate = element.getAttribute('data-date');
                            if (dayDate) {
                                endDragDate = dayDate;
                                updateSelectedDates();
                            }
                        }
                        e.preventDefault();
                    }
                }, { passive: false });
                
                dayEl.addEventListener('touchend', function(e) {
                    if (isDragging) {
                        isDragging = false;
                        const startDateInput = document.getElementById('startDate');
                        const endDateInput = document.getElementById('endDate');
                        startDateInput.value = startDragDate;
                        endDateInput.value = endDragDate;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                        selectedPeriod = {
                            start: startDragDate,
                            end: endDragDate
                        };
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥
                        updatePeriodStats();
                        
                        updateCalendar();
                    }
                    e.preventDefault();
                }, { passive: false });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–π –¥–∞—Ç—ã
                dayEl.onclick = function(e) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª –ª–∏ –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É –≤–Ω—É—Ç—Ä–∏ –¥–Ω—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–º–µ–Ω–µ)
                    if (e.target.closest('.shift-info')) {
                        return;
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –∫–∞–∫ –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞
                    const clickedDate = this.getAttribute('data-date');
                    selectedPeriod = {
                        start: clickedDate,
                        end: clickedDate
                    };
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
                    const startDateInput = document.getElementById('startDate');
                    const endDateInput = document.getElementById('endDate');
                    startDateInput.value = clickedDate;
                    endDateInput.value = clickedDate;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    updatePeriodStats();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                    updateCalendar();
                };
                
                calendarEl.appendChild(dayEl);
            }
            // –î–Ω–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const totalDaysShown = offset + lastDayOfMonth.getDate();
            const remainingCells = 42 - totalDaysShown;
            for (let i = 1; i <= remainingCells; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day p-2 border border-gray-100 text-gray-400 bg-gray-50 min-h-20';
                const date = new Date(year, month + 1, i);
                const dateStr = formatDateToYYYYMMDD(date);
                dayEl.innerHTML = `<div class="text-sm font-medium">${i}</div>`;
                calendarEl.appendChild(dayEl);
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π
            updateSelectedDates();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–µ—Ä–∏–æ–¥
            if (selectedPeriod && selectedPeriod.start && selectedPeriod.end) {
                updatePeriodStats();
            }
            
            displayLog();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
        function updatePeriodStats() {
            if (!selectedPeriod || !selectedPeriod.start || !selectedPeriod.end) {
                return;
            }
            
            const start = new Date(selectedPeriod.start);
            const end = new Date(selectedPeriod.end);
            
            if (end < start) {
                return;
            }
            
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            const filteredShifts = log.filter(entry => {
                const entryDate = new Date(entry.startDate);
                return entryDate >= start && entryDate <= end;
            });
            
            const totalEarnings = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.earnings), 0);
            const shiftsCount = filteredShifts.length;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short' });
            };
            
            document.getElementById('periodEarnings').textContent = `${totalEarnings.toFixed(2)} ‚ÇΩ`;
            document.getElementById('periodShiftsCount').textContent = shiftsCount;
            document.getElementById('periodRange').textContent = `${formatDate(selectedPeriod.start)} - ${formatDate(selectedPeriod.end)}`;
            document.getElementById('periodStatsResults').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–∞—Ç
            const periodStart = document.getElementById('periodStart');
            const periodEnd = document.getElementById('periodEnd');
            periodStart.value = selectedPeriod.start;
            periodEnd.value = selectedPeriod.end;
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞
        function changeMonth(delta) {
            currentViewDate.setMonth(currentViewDate.getMonth() + delta);
            updateCalendar();
            updateYearlyStats();
        }
        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –º–µ—Å—è—Ü—É/–≥–æ–¥—É
        function goToSelectedMonth() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            currentViewDate.setMonth(parseInt(monthSelect.value));
            currentViewDate.setFullYear(parseInt(yearSelect.value));
            updateCalendar();
            updateYearlyStats();
        }
        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–º—É –¥–Ω—é
        function goToToday() {
            currentViewDate = new Date();
            updateCalendar();
            const todayStr = formatDateToYYYYMMDD(currentViewDate);
            document.getElementById('startDate').value = todayStr;
            const endDateInput = document.getElementById('endDate');
            if (!endDateInput.value || endDateInput.value.includes('0002')) {
                endDateInput.value = todayStr;
            }
        }
        // –†–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–º–µ–Ω—ã –≤ —á–∞—Å–∞—Ö
        function calculateDurationInHours(startDateStr, startTimeStr, endDateStr, endTimeStr) {
            const [startHours, startMinutes] = startTimeStr.split(':').map(Number);
            const [endHours, endMinutes] = endTimeStr.split(':').map(Number);
            const startDateTime = new Date(startDateStr);
            startDateTime.setHours(startHours, startMinutes, 0, 0);
            const endDateTime = new Date(endDateStr);
            endDateTime.setHours(endHours, endMinutes, 0, 0);
            const durationMs = endDateTime - startDateTime;
            const durationHours = durationMs / (1000 * 60 * 60);
            return durationHours;
        }
        // –†–∞—Å—á–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞
        function calculateEarnings() {
            const startDateInput = document.getElementById('startDate');
            const startTimeInput = document.getElementById('startTime');
            const endDateInput = document.getElementById('endDate');
            const endTimeInput = document.getElementById('endTime');
            const jobNameInput = document.getElementById('jobName');
            const startDate = startDateInput.value;
            const startTime = startTimeInput.value;
            const endDate = endDateInput.value;
            const endTime = endTimeInput.value;
            const jobName = jobNameInput.value.trim();
            if (!jobName) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã.', 'error');
                return;
            }
            if (!startDate || !startTime || !endDate || !endTime) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.', 'error');
                return;
            }
            if (endDate.includes('0002')) {
                showAlert('–û—à–∏–±–∫–∞ –≤ –≥–æ–¥–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–æ–¥.', 'error');
                return;
            }
            const durationHours = calculateDurationInHours(startDate, startTime, endDate, endTime);
            if (durationHours <= 0) {
                showAlert('–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞.', 'error');
                return;
            }
            const durationCoefficient = getDurationCoefficient(durationHours);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º getBaseRate() –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
            const totalEarnings = getBaseRate() * durationCoefficient;
            const logEntry = {
                id: editingId || Date.now(),
                startDate: startDate,
                startTime: startTime,
                endDate: endDate,
                endTime: endTime,
                jobName: jobName,
                duration: durationHours.toFixed(2),
                earnings: totalEarnings.toFixed(2),
                durationCoefficient: durationCoefficient
            };
            let log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            if (editingId) {
                log = log.map(entry => entry.id === editingId ? logEntry : entry);
                editingId = null;
                document.getElementById('submitButton').innerHTML = '<i class="fas fa-calculator mr-2"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å';
                showAlert('–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
            } else {
                log.push(logEntry);
                showAlert('–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
            }
            localStorage.setItem('shiftLog', JSON.stringify(log));
            updateJobSuggestions();
            updateCalendar();
            clearForm();
        }
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg text-white font-medium z-50 animate-fade-in-up ${type === 'error' ? 'bg-red-500' : 'bg-green-500'}`;
            alert.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-2"></i>
                    ${message}
                </div>
            `;
            document.body.appendChild(alert);
            setTimeout(() => {
                alert.classList.remove('animate-fade-in-up');
                alert.classList.add('animate-fade-out');
                setTimeout(() => alert.remove(), 500);
            }, 3000);
        }
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ –î–õ–ò–¢–ï–õ–¨–ù–û–°–¢–ò —Å–º–µ–Ω—ã –≤ —á–∞—Å–∞—Ö
        function getDurationCoefficient(durationHours) {
            if (durationHours <= 10) return 1;
            if (durationHours <= 13) return 1.4;
            if (durationHours <= 16) return 1.9;
            if (durationHours <= 19) return 2.5;
            if (durationHours <= 22) return 3.2;
            if (durationHours <= 25) return 4;
            if (durationHours <= 28) return 4.9;
            if (durationHours <= 31) return 5.9;
            if (durationHours <= 34) return 7;
            return 7;
        }
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        function displayLog() {
            const logContainer = document.getElementById('log');
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            if (log.length === 0) {
                logContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="far fa-calendar-alt text-3xl mb-2"></i>
                        <p>–ó–∞–ø–∏—Å–µ–π –æ —Å–º–µ–Ω–∞—Ö –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                    </div>
                `;
                return;
            }
            const currentMonthStr = getYearMonth(formatDateToYYYYMMDD(currentViewDate));
            const shiftsThisMonth = log.filter(entry => getYearMonth(entry.endDate) === currentMonthStr);
            if (shiftsThisMonth.length === 0) {
                logContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="text-3xl mb-2">‚ñ†</span>
                        <p>–ó–∞–ø–∏—Å–µ–π –æ —Å–º–µ–Ω–∞—Ö –∑–∞ ${document.getElementById('monthDisplay').textContent} –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                    </div>
                `;
                return;
            }
            const workGroups = {};
            shiftsThisMonth.forEach(entry => {
                if (!workGroups[entry.jobName]) {
                    workGroups[entry.jobName] = {
                        jobName: entry.jobName,
                        totalEarnings: 0,
                        shifts: []
                    };
                }
                workGroups[entry.jobName].totalEarnings += parseFloat(entry.earnings);
                workGroups[entry.jobName].shifts.push(entry);
            });
            const sortedGroups = Object.values(workGroups).sort((a, b) => b.totalEarnings - a.totalEarnings);
            let logHtml = `
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-history mr-2 text-green-600"></i> –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–±–æ—Ç –∑–∞ ${document.getElementById('monthDisplay').textContent}
                    </h2>
                </div>
            `;
            sortedGroups.forEach(group => {
                const style = getWorkStyle(group.jobName);
                logHtml += `
                    <div class="work-group mb-6 bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200">
                        <div class="work-group-header p-4 hover:bg-gray-50 cursor-pointer flex justify-between items-center" onclick="toggleDetails(this)">
                            <div class="work-group-job font-semibold flex items-center" style="color: ${style.borderColor}">
                                <i class="fas fa-briefcase mr-2"></i>${group.jobName}
                            </div>
                            <div class="work-group-summary font-bold text-green-600 flex items-center">
                                <i class="fas fa-coins mr-1"></i>${group.totalEarnings.toFixed(2)}
                                <span class="ml-3 text-gray-400 chevron-rotate"><i class="fas fa-chevron-down"></i></span>
                            </div>
                        </div>
                        <div class="work-group-details hidden bg-gray-50 p-4 border-t border-gray-200">
                `;
                group.shifts.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));
                group.shifts.forEach(shift => {
                    const coeffColor = coefficientColors[shift.durationCoefficient] || '#808080';
                    logHtml += `
                        <div class="shift-item mb-3 pb-3 border-b border-gray-100 last:border-0 last:mb-0 last:pb-0">
                            <div class="flex flex-wrap items-center justify-between mb-1">
                                <div class="font-medium text-gray-700">
                                    <span class="icon-calendar"></span>${shift.startDate}
                                    <span class="icon-clock"></span>${shift.startTime} - ${shift.endTime}
                                </div>
                                <div class="flex items-center">
                                    <span class="text-xs px-2 py-1 rounded mr-2 text-white" style="background-color: ${coeffColor}">
                                        K${shift.durationCoefficient}
                                    </span>
                                    <span class="font-bold text-green-600">
                                        <span class="icon-ruble"></span>${shift.earnings}
                                    </span>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500 flex items-center justify-between">
                                <span>
                                    <i class="fas fa-hourglass-half mr-1"></i>${shift.duration} —á
                                </span>
                                <div>
                                    <button onclick="editShift(${shift.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-edit mr-1"></i>–†–µ–¥.
                                    </button>
                                    <button onclick="deleteShift(${shift.id})" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash-alt mr-1"></i>–£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                logHtml += `
                        </div>
                        <div class="log-entry-actions p-3 bg-gray-100">
                            <button class="delete-all-btn px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition text-sm font-medium" onclick="deleteWorkGroup('${group.jobName}')">
                                <i class="fas fa-trash mr-1"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ "${group.jobName}"
                            </button>
                        </div>
                    </div>
                `;
            });
            const grandTotalEarnings = sortedGroups.reduce((sum, group) => sum + group.totalEarnings, 0);
            logHtml += `
                <div class="summary p-5 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-700 text-white text-right shadow-md mb-6">
                    <div class="text-xl font-bold">
                        <i class="fas fa-wallet mr-2"></i> –í–°–ï–ì–û –ó–ê–†–ê–ë–û–¢–ê–ù–û: ${grandTotalEarnings.toFixed(2)} <i class="fas fa-ruble-sign text-sm"></i>
                    </div>
                </div>
            `;
            // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–º–µ–Ω—ã –∑–∞ –º–µ—Å—è—Ü
            logHtml += `
                <button onclick="deleteAllForMonth()" class="w-full px-6 py-3 bg-purple-700 hover:bg-purple-800 text-white rounded-lg transition font-medium flex items-center justify-center">
                    <i class="fas fa-trash-alt mr-2"></i> –£–¥–∞–ª–∏—Ç—å –í–°–ï —Å–º–µ–Ω—ã –∑–∞ ${document.getElementById('monthDisplay').textContent}
                </button>
            `;
            logContainer.innerHTML = logHtml;
        }
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ø–æ–π–ª–µ—Ä–∞
        function toggleDetails(header) {
            const chevron = header.querySelector('.chevron-rotate');
            const details = header.nextElementSibling;
            details.classList.toggle('hidden');
            if (details.classList.contains('hidden')) {
                chevron.classList.remove('rotate-180');
            } else {
                chevron.classList.add('rotate-180');
            }
        }
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã
        function editShift(id) {
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            const entry = log.find(e => e.id === id);
            if (entry) {
                document.getElementById('startDate').value = entry.startDate;
                document.getElementById('startTime').value = entry.startTime;
                document.getElementById('endDate').value = entry.endDate;
                document.getElementById('endTime').value = entry.endTime;
                document.getElementById('jobName').value = entry.jobName;
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ —Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –æ–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)
                document.getElementById('baseRate').value = getBaseRate();
                editingId = id;
                document.getElementById('submitButton').innerHTML = '<i class="fas fa-save mr-2"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                document.querySelector('.form').scrollIntoView({behavior: 'smooth'});
            }
        }
        // –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π —Å–º–µ–Ω—ã
        function deleteShift(id) {
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–º–µ–Ω—É?',
                text: "–í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '–î–∞, —É–¥–∞–ª–∏—Ç—å!',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    let log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
                    log = log.filter(entry => entry.id !== id);
                    localStorage.setItem('shiftLog', JSON.stringify(log));
                    updateJobSuggestions();
                    updateCalendar();
                    showAlert('–°–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!', 'success');
                }
            });
        }
        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–º–µ–Ω –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ä–∞–±–æ—Ç—ã
        function deleteWorkGroup(jobName) {
            Swal.fire({
                title: `–£–¥–∞–ª–∏—Ç—å –í–°–ï —Å–º–µ–Ω—ã –ø–æ —Ä–∞–±–æ—Ç–µ "${jobName}"?`,
                text: "–í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '–î–∞, —É–¥–∞–ª–∏—Ç—å!',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    let log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
                    log = log.filter(entry => entry.jobName !== jobName);
                    localStorage.setItem('shiftLog', JSON.stringify(log));
                    updateJobSuggestions();
                    updateCalendar();
                    showAlert(`–í—Å–µ —Å–º–µ–Ω—ã "${jobName}" —É–¥–∞–ª–µ–Ω—ã!`, 'success');
                }
            });
        }
        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–º–µ–Ω –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
        function deleteAllForMonth() {
            Swal.fire({
                title: `–£–¥–∞–ª–∏—Ç—å –í–°–ï —Å–º–µ–Ω—ã –∑–∞ ${document.getElementById('monthDisplay').textContent}?`,
                text: "–í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '–î–∞, —É–¥–∞–ª–∏—Ç—å!',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    const currentMonthStr = getYearMonth(formatDateToYYYYMMDD(currentViewDate));
                    let log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
                    log = log.filter(entry => getYearMonth(entry.endDate) !== currentMonthStr);
                    localStorage.setItem('shiftLog', JSON.stringify(log));
                    updateJobSuggestions();
                    updateCalendar();
                    showAlert(`–í—Å–µ —Å–º–µ–Ω—ã –∑–∞ ${document.getElementById('monthDisplay').textContent} —É–¥–∞–ª–µ–Ω—ã!`, 'success');
                }
            });
        }
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        function clearForm() {
            const today = new Date();
            const todayStr = formatDateToYYYYMMDD(today);
            document.getElementById('startDate').value = todayStr;
            document.getElementById('startTime').value = '09:00';
            document.getElementById('endDate').value = todayStr;
            document.getElementById('endTime').value = '18:00';
            document.getElementById('jobName').value = '';
            // –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ñ–æ—Ä–º—ã —Ç–∞–∫–∂–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —Ç–µ–∫—É—â–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ
            document.getElementById('baseRate').value = getBaseRate();
            editingId = null;
            document.getElementById('submitButton').innerHTML = '<i class="fas fa-calculator mr-2"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å';
        }
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–∞
        function loadLog() {
            updateCalendar();
        }
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º —Ä–∞–±–æ—Ç
        function updateJobSuggestions() {
            const jobSuggestions = document.getElementById('jobSuggestions');
            jobSuggestions.innerHTML = '';
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            const jobNames = [...new Set(log.map(entry => entry.jobName))];
            jobNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                jobSuggestions.appendChild(option);
            });
        }
        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å–º–µ–Ω –≤ —Ñ–∞–π–ª
        function exportShifts() {
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            if (log.length === 0) {
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            const dataStr = JSON.stringify(log, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `shifts_export_${new Date().toISOString().slice(0,10)}.json`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            showAlert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }
        // –ò–º–ø–æ—Ä—Ç —Å–º–µ–Ω –∏–∑ —Ñ–∞–π–ª–∞
        function importShifts(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) {
                        throw new Error('Invalid data format');
                    }
                    Swal.fire({
                        title: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∏–º–ø–æ—Ä—Ç',
                        text: `–ë—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${importedData.length} —Å–º–µ–Ω. –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: '–î–∞, –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å',
                        cancelButtonText: '–û—Ç–º–µ–Ω–∞'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ backup
                            const currentData = JSON.parse(localStorage.getItem('shiftLog') || '[]');
                            localStorage.setItem('shiftLog_backup', JSON.stringify(currentData));
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                            localStorage.setItem('shiftLog', JSON.stringify(importedData));
                            updateJobSuggestions();
                            updateCalendar();
                            showAlert(`–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${importedData.length} —Å–º–µ–Ω`, 'success');
                        }
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º input —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª —Å–Ω–æ–≤–∞
                        input.value = '';
                    });
                } catch (e) {
                    showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö', 'error');
                    input.value = '';
                }
            };
            reader.readAsText(file);
        }
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function switchTab(tab) {
            const yearTab = document.getElementById('yearTab');
            const periodTab = document.getElementById('periodTab');
            const yearStats = document.getElementById('yearStats');
            const periodStats = document.getElementById('periodStats');
            
            if (tab === 'year') {
                yearTab.classList.add('bg-white', 'border-t', 'border-l', 'border-r', 'border-gray-200');
                yearTab.classList.remove('hover:bg-gray-100');
                periodTab.classList.remove('bg-white', 'border-t', 'border-l', 'border-r', 'border-gray-200');
                periodTab.classList.add('hover:bg-gray-100');
                
                yearStats.classList.remove('hidden');
                periodStats.classList.add('hidden');
            } else {
                periodTab.classList.add('bg-white', 'border-t', 'border-l', 'border-r', 'border-gray-200');
                periodTab.classList.remove('hover:bg-gray-100');
                yearTab.classList.remove('bg-white', 'border-t', 'border-l', 'border-r', 'border-gray-200');
                yearTab.classList.add('hover:bg-gray-100');
                
                periodStats.classList.remove('hidden');
                yearStats.classList.add('hidden');
            }
        }
        
        // –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
        function calculatePeriodStats() {
            const periodStart = document.getElementById('periodStart').value;
            const periodEnd = document.getElementById('periodEnd').value;
            
            if (!periodStart || !periodEnd) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞', 'error');
                return;
            }
            
            const start = new Date(periodStart);
            const end = new Date(periodEnd);
            
            if (end < start) {
                showAlert('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞', 'error');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
            selectedPeriod = {
                start: periodStart,
                end: periodEnd
            };
            
            const log = JSON.parse(localStorage.getItem('shiftLog') || '[]');
            const filteredShifts = log.filter(entry => {
                const entryDate = new Date(entry.startDate);
                return entryDate >= start && entryDate <= end;
            });
            
            const totalEarnings = filteredShifts.reduce((sum, shift) => sum + parseFloat(shift.earnings), 0);
            const shiftsCount = filteredShifts.length;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short' });
            };
            
            document.getElementById('periodEarnings').textContent = `${totalEarnings.toFixed(2)} ‚ÇΩ`;
            document.getElementById('periodShiftsCount').textContent = shiftsCount;
            document.getElementById('periodRange').textContent = `${formatDate(periodStart)} - ${formatDate(periodEnd)}`;
            document.getElementById('periodStatsResults').classList.remove('hidden');
            
            showAlert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
            updateCalendar();
        }
        
        // SweetAlert for beautiful dialogs
        function showAlert(message, type) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });
            Toast.fire({
                icon: type,
                title: message
            });
        }
    </script>
    <!-- SweetAlert for beautiful dialogs -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Initialize SweetAlert as Swal
        const Swal = window.Swal;
    </script>
</body>
</html>
```